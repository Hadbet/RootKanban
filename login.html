<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión - Sistema de Rutas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        #video-bg {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            width: auto;
            height: auto;
            z-index: -100;
            filter: brightness(0.3);
        }
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-900">

<video autoplay muted loop id="video-bg">
    <!-- Reemplaza este video por uno tuyo. Puedes buscar en Pexels.com por "Warehouse" o "Factory" -->
    <source src="https://grammermx.com/AleTest/ATS/videos/Video.mp4" type="video/mp4">
    Tu navegador no soporta videos HTML5.
</video>

<div class="flex items-center justify-center min-h-screen text-white">
    <div class="w-full max-w-md p-8 space-y-8 bg-gray-800 bg-opacity-80 backdrop-blur-sm rounded-2xl shadow-2xl">
        <div class="text-center">
            <img src="images/Grammer_Logo_Original_White_sRGB_screen_transparent.png" alt="Logo" class="mx-auto mb-4">
            <h1 class="text-3xl font-bold text-orange-400">Control de Rutas</h1>
            <p class="text-gray-400">Bienvenido. Ingresa tus credenciales.</p>
        </div>
        <form id="login-form" class="space-y-6">
            <div>
                <label for="id-usuario" class="block mb-2 text-sm font-medium text-gray-300">Número de Nómina / ID</label>
                <input type="text" name="IdUsuarios" id="id-usuario" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5" placeholder="Tu número de nómina" required>
            </div>
            <div>
                <label for="password" class="block mb-2 text-sm font-medium text-gray-300">Contraseña</label>
                <input type="password" name="Password" id="password" placeholder="••••••••" class="bg-gray-700 border border-gray-600 text-white text-sm rounded-lg focus:ring-orange-500 focus:border-orange-500 block w-full p-2.5" required>
            </div>
            <button type="submit" class="w-full text-white bg-orange-600 hover:bg-orange-700 focus:ring-4 focus:outline-none focus:ring-orange-500 font-medium rounded-lg text-lg px-5 py-3 text-center">
                Iniciar Sesión
            </button>
        </form>
        <div id="error-message" class="text-center text-red-400 font-medium hidden"></div>
    </div>
</div>

<script>
    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const errorMessage = document.getElementById('error-message');
        errorMessage.classList.add('hidden');

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('https://grammermx.com/Logistica/RootKanBan/dao/login.php', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            const result = await response.json();

            if (result.success) {
                // Guardar datos del usuario en la sesión del navegador
                sessionStorage.setItem('usuario', JSON.stringify(result.data));

                // Redirigir según el rol
                if (result.data.Rol === '2') { // Administrador
                    window.location.href = 'vizor_paradas.html';
                } else if (result.data.Rol === '1') { // Conductor
                    window.location.href = 'registro_parada.html';
                } else {
                    errorMessage.textContent = 'Rol de usuario no reconocido.';
                    errorMessage.classList.remove('hidden');
                }
            } else {
                errorMessage.textContent = result.message || 'Error en el inicio de sesión.';
                errorMessage.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Error de conexión:', error);
            errorMessage.textContent = 'No se pudo conectar con el servidor.';
            errorMessage.classList.remove('hidden');
        }
    });
</script>
</body>
</html>
